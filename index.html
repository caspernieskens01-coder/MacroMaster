<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MACROMASTER ‚Äî Recepten + per‚Äërecept macro‚Äëcalculator</title>
  <style>
    :root{
      --bg:#070a0c;--card:#11161a;--muted:#a3a3a3;--text:#eaf2f7;--acc:#0BDBE1;--chip:#0e151a;--border:#222b33
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial;background:var(--bg);color:var(--text)}
    .wrap{max-width:1100px;margin:0 auto;padding:20px}
    header{position:sticky;top:0;z-index:10;background:rgba(7,10,12,.9);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
    .brand{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .brand h1{margin:0;font-weight:900;letter-spacing:.6px}
    .by{font-size:12px;color:#7aa0ab}
    .row{display:flex;gap:10px;align-items:center}

    /* top controls */
    .search{width:100%;background:#0e181f;border:1px solid #1e2a33;color:var(--text);padding:14px 16px;border-radius:14px;outline:none}
    .pillbar{display:flex;flex-wrap:wrap;gap:10px;margin:12px 0 6px}
    .pill{padding:8px 12px;background:var(--chip);border:1px solid #1a242c;border-radius:999px;color:#b4d3dc;font-size:13px}
    .btn{all:unset;background:var(--acc);color:#03242a;font-weight:800;border-radius:12px;padding:10px 14px;cursor:pointer}
    .btn.ghost{background:#0e181f;color:#9adfe4;border:1px solid #0f2a30}
    .tag{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid #1a242c;border-radius:999px;background:#0e151a;color:#cde9ee;font-size:12px}

    /* cards */
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:18px;margin-top:12px}
    .card{grid-column:span 6;background:var(--card);border:1px solid var(--border);border-radius:18px;padding:18px;box-shadow:0 6px 24px rgba(0,0,0,.25)}
    .card h3{margin:0 0 6px}
    .card .desc{color:#b7c8cf;margin:4px 0 10px}
    .card .tagbar{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0 12px}
    .card .open{display:block;margin-top:8px}

    /* detail */
    .back{display:inline-block;margin:0 0 16px;color:#9adfe4}
    .title{font-size:36px;font-weight:900;margin:6px 0}
    .subtitle{color:#b7c8cf;margin-bottom:14px}
    .two{display:grid;grid-template-columns:1.1fr .9fr;gap:20px}
    .panel{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:16px}
    .inputs{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:14px}
    .inputs label{display:block;font-size:13px;color:#cfe3e8;margin-bottom:6px}
    .in{width:100%;padding:12px 12px;border-radius:12px;border:1px solid #24343f;background:#0f171c;color:var(--text)}
    .apply{margin-top:4px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid #1d2931}
    th{text-align:left;color:#cfe3e8}
    tfoot td{font-weight:800;border-top:1px solid #2a3942}

    .summary{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .chip{background:#0f171c;border:1px solid #1e2a33;border-radius:16px;padding:12px;text-align:center}
    .chip .num{font-size:22px;font-weight:900}

    @media (max-width:980px){.two{grid-template-columns:1fr}.inputs{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:640px){.card{grid-column:span 12}.inputs{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header>
    <div class="wrap brand">
      <div>
        <div class="by">by CASPER PT</div>
        <h1>MACROMASTER</h1>
      </div>
      <div class="row">
        <span id="jsonStatus" class="tag">üîé JSON‚Äëgestuurd</span>
        <button id="clearBtn" class="btn ghost">Wissen</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- SEARCH + PILLS -->
    <input id="q" class="search" placeholder="Zoek op titel of ingredi√´nt‚Ä¶" />
    <div id="pills" class="pillbar"></div>

    <!-- LIST -->
    <section id="listView">
      <div id="cards" class="grid"></div>
    </section>

    <!-- DETAIL -->
    <section id="detailView" hidden>
      <a href="#" class="back" onclick="return backToList()">‚Üê Terug</a>
      <h2 id="dTitle" class="title"></h2>
      <div id="dSubtitle" class="subtitle"></div>

      <div class="two">
        <div class="panel">
          <div class="inputs">
            <div>
              <label>Porties</label>
              <input id="inServ" class="in" type="number" min="1" value="4" />
            </div>
            <div>
              <label>Vlees p.p. (g)</label>
              <input id="inMeat" class="in" type="number" min="0" value="100" />
            </div>
            <div>
              <label>Rijst p.p. (g droog)</label>
              <input id="inRice" class="in" type="number" min="0" value="80" />
            </div>
            <div>
              <label>Groente p.p. (g)</label>
              <input id="inVeg" class="in" type="number" min="0" value="200" />
            </div>
            <div>
              <label>Water in saus (ml, totaal)</label>
              <input id="inWater" class="in" type="number" min="0" value="20" />
            </div>
            <div style="align-self:end"><button id="apply" class="btn apply">Toepassen</button></div>
          </div>

          <h3>Ingredi√´nten</h3>
          <div class="panel" style="padding:0">
            <table id="tbl">
              <thead>
                <tr><th>Ingredi√´nt</th><th>Hoeveelheid</th><th>Eiwit</th><th>Khd</th><th>Vet</th><th>kcal</th></tr>
              </thead>
              <tbody></tbody>
              <tfoot>
                <tr><td>Totaal</td><td id="tQty">‚Äî</td><td id="tP">‚Äî</td><td id="tC">‚Äî</td><td id="tF">‚Äî</td><td id="tK">‚Äî</td></tr>
              </tfoot>
            </table>
          </div>

          <h3 style="margin-top:16px">Bereiding</h3>
          <div id="steps" class="panel"></div>
        </div>

        <div class="panel">
          <h3>Macro's (hele bereiding)</h3>
          <div class="summary">
            <div class="chip"><div>Eiwit</div><div id="sP" class="num">‚Äî</div><div>g</div></div>
            <div class="chip"><div>Koolhydraten</div><div id="sC" class="num">‚Äî</div><div>g</div></div>
            <div class="chip"><div>Vetten</div><div id="sF" class="num">‚Äî</div><div>g</div></div>
            <div class="chip"><div>Calorie√´n</div><div id="sK" class="num">‚Äî</div><div>kcal</div></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    const $ = (q, el=document) => el.querySelector(q);
    const $$ = (q, el=document) => [...el.querySelectorAll(q)];
    const state = { all: [], view:'list', current:null };

    const NUTRIENTS = {
      // per 100g (of per 100ml waar unit==='ml')
      beef_raw:{p:22,c:0,f:4,k:130},
      rice_dry:{p:7,c:78,f:0.6,k:360},
      broccoli_raw:{p:3,c:7,f:0.4,k:35},
      oil:{p:0,c:0,f:100,k:900},
      soy_sauce_ml:{p:5,c:6,f:0,k:80},
      rice_vinegar_ml:{p:0,c:1,f:0,k:3.3},
      sesame_oil:{p:0,c:0,f:100,k:900},
      garlic:{p:6.4,c:33,f:0.5,k:149},
      ginger:{p:1.8,c:18,f:0.8,k:80},
      water:{p:0,c:0,f:0,k:0}
    };

    function fmt(x){return (Math.round(x*10)/10).toLocaleString('nl-NL')}

    async function loadData(){
      try{
        const r = await fetch('./recipes.json?cb='+Date.now());
        if(!r.ok) throw new Error(r.status);
        return await r.json();
      }catch(e){
        console.warn('fallback json omdat recipes.json niet laadt', e);
        return [
          {
            id:'beef-teriyaki',
            title:'Beef Teriyaki',
            subtitle:'Suikervrij, zonder binders. Glans door reductie. Sojasaus, gember, knoflook.',
            tags:['vlees','rijst'],
            params:{servings:4, meat_g:100, rice_g_dry:80, veg_g:200, water_ml_total:20},
            model:'beef_teriyaki'
          },
          {
            id:'kip-rijst-groente',
            title:'Kip ‚Ä¢ Rijst ‚Ä¢ Groente',
            subtitle:'Basis fitness recept; stel g/pp in en schaal porties + macro\'s.',
            tags:['kip','rijst'],
            params:{servings:4, meat_g:120, rice_g_dry:75, veg_g:200, water_ml_total:0},
            model:'chicken_rice_veg'
          }
        ];
      }
    }

    function buildPills(){
      const allTags = [...new Set(state.all.flatMap(r=>r.tags||[]))].slice(0,10);
      $('#pills').innerHTML = allTags.map(t=>`<button class="pill" data-t="${t}">${t}</button>`).join('');
      $$('#pills .pill').forEach(el=> el.addEventListener('click',()=>{ $('#q').value = t(el); filter(); }));
      function t(el){return el.getAttribute('data-t')}
    }

    function filter(){
      const q = ($('#q').value||'').toLowerCase();
      const list = state.all.filter(r => (r.title+ ' ' + (r.subtitle||'') + ' ' + (r.tags||[]).join(' ')).toLowerCase().includes(q));
      renderCards(list);
    }

    function renderCards(list){
      const c = $('#cards'); c.innerHTML='';
      list.forEach(r=>{
        const el = document.createElement('article');
        el.className='card';
        el.innerHTML = `
          <h3>${r.title}</h3>
          <div class="desc">${r.subtitle||''}</div>
          <div class="tagbar">${(r.tags||[]).map(x=>`<span class="pill">${x}</span>`).join('')}</div>
          <button class="btn open">Open recept</button>
        `;
        el.querySelector('.open').addEventListener('click',()=> openDetail(r.id));
        c.appendChild(el);
      })
    }

    function openDetail(id){
      const r = state.all.find(x=>x.id===id); if(!r) return;
      state.current = JSON.parse(JSON.stringify(r));
      $('#dTitle').textContent = r.title; $('#dSubtitle').textContent = r.subtitle||'';
      $('#inServ').value = r.params?.servings ?? 4;
      $('#inMeat').value = r.params?.meat_g ?? 100;
      $('#inRice').value = r.params?.rice_g_dry ?? 80;
      $('#inVeg').value = r.params?.veg_g ?? 200;
      $('#inWater').value = r.params?.water_ml_total ?? 0;
      calcAndRender();
      document.getElementById('detailView').hidden = false;
      document.getElementById('listView').hidden = true;
      history.pushState({id}, '', '#/'+id);
      window.scrollTo({top:0,behavior:'smooth'});
    }

    function backToList(){
      document.getElementById('detailView').hidden = true;
      document.getElementById('listView').hidden = false;
      history.pushState({}, '', '#/');
      return false;
    }

    $('#apply')?.addEventListener('click', ()=> calcAndRender());
    $('#q').addEventListener('input', filter);
    $('#clearBtn').addEventListener('click', ()=>{ $('#q').value=''; filter(); });

    function calcAndRender(){
      const s = +$('#inServ').value, meat = +$('#inMeat').value, rice = +$('#inRice').value, veg=+$('#inVeg').value, wml=+$('#inWater').value;
      const r = state.current;
      const model = r.model;

      // Build ingredient rows depending on model
      let rows = [];
      if(model==='beef_teriyaki'){
        rows = [
          ingr('Rundereepjes (rauw)', s*meat, 'g', NUTRIENTS.beef_raw),
          ingr('Witte rijst (droog)', s*rice, 'g', NUTRIENTS.rice_dry),
          ingr('Broccoli (rauw)', s*veg, 'g', NUTRIENTS.broccoli_raw),
          ingr('Neutrale olie', 10, 'g', NUTRIENTS.oil),
          ingr('Sojasaus', 80, 'ml', NUTRIENTS.soy_sauce_ml),
          ingr('Rijstazijn', 30, 'ml', NUTRIENTS.rice_vinegar_ml),
          ingr('Sesamolie', 5, 'g', NUTRIENTS.sesame_oil),
          ingr('Knoflook', 6, 'g', NUTRIENTS.garlic),
          ingr('Gember', 20, 'g', NUTRIENTS.ginger),
          ingr('Water', wml, 'ml', NUTRIENTS.water)
        ];
        $('#steps').innerHTML = `<ol style="margin:0 0 0 18px;padding:12px">
          <li><b>Marineren (15‚Äì60 min)</b>: Meng sojasaus, rijstazijn, sesamolie, knoflook en gember. 2 el apart. Rest over het vlees.</li>
          <li><b>Bakken</b>: Dep vlees droog. Wok/koekenpan heet met 1 el olie. Bak in batches 1‚Äì2 min bruin. Uit de pan.</li>
          <li><b>Inkoken</b>: Rauwe marinade in pan, 2‚Äì3 min hard koken tot stroperig (reductie).</li>
          <li><b>Afmaken</b>: Vlees terug, 20‚Äì30 s omscheppen tot glans. Eventueel 1‚Äì2 el water erbij voor dun glazuur.</li>
        </ol>`;
      } else if(model==='chicken_rice_veg'){
        rows = [
          ingr('Kipfilet (rauw)', s*meat, 'g', {p:23,c:0,f:1.5,k:110}),
          ingr('Witte rijst (droog)', s*rice, 'g', NUTRIENTS.rice_dry),
          ingr('Groentemix (rauw)', s*veg, 'g', {p:2,c:6,f:0.2,k:30}),
          ingr('Olijfolie', 8, 'g', NUTRIENTS.oil),
          ingr('Kruiden/zout', 2, 'g', {p:0,c:0,f:0,k:0})
        ];
        $('#steps').innerHTML = `<ol style="margin:0 0 0 18px;padding:12px">
          <li>Kip in blokjes, kruiden. Bak goudbruin.</li>
          <li>Rijst koken (droog gewogen).</li>
          <li>Groente roerbakken tot beetgaar. Alles samen serveren.</li>
        </ol>`;
      }

      // render table
      const tbody = $('#tbl tbody'); tbody.innerHTML='';
      let TP=0, TC=0, TF=0, TK=0, TQ=0;
      for(const r of rows){
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${r.n}</td><td>${fmt(r.qty)} ${r.unit}</td><td>${fmt(r.p)}</td><td>${fmt(r.c)}</td><td>${fmt(r.f)}</td><td>${fmt(r.k)}</td>`;
        tbody.appendChild(tr);
        TP+=r.p; TC+=r.c; TF+=r.f; TK+=r.k; TQ+=r.qty;
      }
      $('#tQty').textContent = fmt(TQ) + ' g/ml';
      $('#tP').textContent = fmt(TP);
      $('#tC').textContent = fmt(TC);
      $('#tF').textContent = fmt(TF);
      $('#tK').textContent = fmt(TK);
      $('#sP').textContent = fmt(TP);
      $('#sC').textContent = fmt(TC);
      $('#sF').textContent = fmt(TF);
      $('#sK').textContent = fmt(TK);
    }

    function ingr(name, qty, unit, per100){
      const factor = qty/100;
      const p = per100.p*factor, c = per100.c*factor, f = per100.f*factor, k = per100.k*factor;
      return {n:name, qty, unit, p, c, f, k};
    }

    (async function init(){
      const data = await loadData(); state.all = data; buildPills(); renderCards(state.all);
      const hash = location.hash.replace('#/',''); if(hash){ openDetail(hash) }
      window.addEventListener('popstate', ()=>{ const h=location.hash.replace('#/',''); if(h) openDetail(h); else backToList(); });
    })();
  </script>
</body>
</html>
